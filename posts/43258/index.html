<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><link href="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.1.0/css/index.css" rel="stylesheet"><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="AWEI"><meta name="keywords" content="AWEI,AWEI的技术小屋"><meta name="description" content="核心概念 线程就是独立的执行路径 在程序运行时，即使没有自己创建线程，后台也会有多个线程，如主线程，gc 线程  main () 称之为主线程，为系统入口，用于执行整个程序 在一个进程中，如果开辟了多个线程，线程的运行由调度器安排调度，调度器是与操作系统紧密相关的，先后顺序是不能人为的干预的 对同一份资源操作时，会存在资源抢夺的问题，需要加入并发控制 线程会带来额外的开销，如 cpu 调度时间，并"><meta property="og:type" content="article"><meta property="og:title" content="Java 多线程学习笔记"><meta property="og:url" content="https://www.inencoding.com/posts/43258/index.html"><meta property="og:site_name" content="In-Encoding"><meta property="og:description" content="核心概念 线程就是独立的执行路径 在程序运行时，即使没有自己创建线程，后台也会有多个线程，如主线程，gc 线程  main () 称之为主线程，为系统入口，用于执行整个程序 在一个进程中，如果开辟了多个线程，线程的运行由调度器安排调度，调度器是与操作系统紧密相关的，先后顺序是不能人为的干预的 对同一份资源操作时，会存在资源抢夺的问题，需要加入并发控制 线程会带来额外的开销，如 cpu 调度时间，并"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.inencoding.com/img/%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B.png"><meta property="article:published_time" content="2021-03-13T13:17:24.000Z"><meta property="article:modified_time" content="2022-12-08T15:28:22.398Z"><meta property="article:author" content="AWEI"><meta property="article:tag" content="多线程"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.inencoding.com/img/%E6%96%87%E7%AB%A0/%E5%A4%9A%E7%BA%BF%E7%A8%8B.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>Java 多线程学习笔记 - In-Encoding</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/fluid-extention.css"><script id="fluid-configs">var dntVal,Fluid=window.Fluid||{},CONFIG=(Fluid.ctx=Object.assign({},Fluid.ctx),{hostname:"www.inencoding.com",root:"/",version:"1.9.2",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,follow_dnt:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"https://cdn.jsdelivr.net/gh/AWeiIsCoding/AWeiIsCoding.github.io/local-search.xml"});CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><style>.spoiler{display:inline-flex}p.spoiler{display:flex}.spoiler a{pointer-events:none}.spoiler-blur,.spoiler-blur>*{transition:text-shadow .5s ease}.spoiler .spoiler-blur,.spoiler .spoiler-blur>*{color:transparent;background-color:rgba(0,0,0,0);text-shadow:0 0 10px grey;cursor:pointer}.spoiler .spoiler-blur:hover,.spoiler .spoiler-blur:hover>*{text-shadow:0 0 5px grey}.spoiler-box,.spoiler-box>*{transition:color .5s ease,background-color .5s ease}.spoiler .spoiler-box,.spoiler .spoiler-box>*{color:#000;background-color:#000;text-shadow:none}</style><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="In-Encoding" type="application/atom+xml"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>InEncoding</strong></a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/background.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Java 多线程学习笔记"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> AWEI</span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-13 21:17" pubdate>2021年3月13日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 32k 字</span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 263 分钟</span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="学习笔记" id="heading-078425eaf316a180b0989442e53f920b" role="tab" data-toggle="collapse" href="#collapse-078425eaf316a180b0989442e53f920b" aria-expanded="true">学习笔记 <span class="list-group-count">(22)</span><i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-078425eaf316a180b0989442e53f920b" role="tabpanel" aria-labelledby="heading-078425eaf316a180b0989442e53f920b"><div class="category-post-list"><a href="/posts/53027/" title="Ajax 和 Json" class="list-group-item list-group-item-action"><span class="category-post">Ajax 和 Json</span></a> <a href="/posts/40991/" title="Docker" class="list-group-item list-group-item-action"><span class="category-post">Docker</span></a> <a href="/posts/22111/" title="JQuery 学习笔记" class="list-group-item list-group-item-action"><span class="category-post">JQuery 学习笔记</span></a> <a href="/posts/43258/" title="Java 多线程学习笔记" class="list-group-item list-group-item-action active"><span class="category-post">Java 多线程学习笔记</span></a> <a href="/posts/12475/" title="Java 注解与反射" class="list-group-item list-group-item-action"><span class="category-post">Java 注解与反射</span></a> <a href="/posts/15254/" title="Java 网络编程学习笔记" class="list-group-item list-group-item-action"><span class="category-post">Java 网络编程学习笔记</span></a> <a href="/posts/16781/" title="JavaWeb 学习笔记" class="list-group-item list-group-item-action"><span class="category-post">JavaWeb 学习笔记</span></a> <a href="/posts/33152/" title="MyBatis-Plus" class="list-group-item list-group-item-action"><span class="category-post">MyBatis-Plus</span></a> <a href="/posts/39805/" title="MySQL 学习笔记" class="list-group-item list-group-item-action"><span class="category-post">MySQL 学习笔记</span></a> <a href="/posts/15608/" title="Mybatis" class="list-group-item list-group-item-action"><span class="category-post">Mybatis</span></a> <a href="/posts/27273/" title="Redis" class="list-group-item list-group-item-action"><span class="category-post">Redis</span></a> <a href="/posts/18155/" title="Spring" class="list-group-item list-group-item-action"><span class="category-post">Spring</span></a> <a href="/posts/46897/" title="Spring MVC" class="list-group-item list-group-item-action"><span class="category-post">Spring MVC</span></a> <a href="/posts/33757/" title="SpringBoot" class="list-group-item list-group-item-action"><span class="category-post">SpringBoot</span></a> <a href="/posts/42622/" title="SpringCloud" class="list-group-item list-group-item-action"><span class="category-post">SpringCloud</span></a> <a href="/posts/43782/" title="Vue" class="list-group-item list-group-item-action"><span class="category-post">Vue</span></a> <a href="/posts/43167/" title="git" class="list-group-item list-group-item-action"><span class="category-post">git</span></a> <a href="/posts/62461/" title="python 爬虫" class="list-group-item list-group-item-action"><span class="category-post">python 爬虫</span></a> <a href="/posts/13607/" title="基于 Centos6.5 的 Httpd 安装" class="list-group-item list-group-item-action"><span class="category-post">基于 Centos6.5 的 Httpd 安装</span></a> <a href="/posts/6262/" title="基于 Centos6.8 的 Hadoop 分布式集群安装" class="list-group-item list-group-item-action"><span class="category-post">基于 Centos6.8 的 Hadoop 分布式集群安装</span></a> <a href="/posts/59309/" title="基于 Centos7 的 Zookeeper 安装" class="list-group-item list-group-item-action"><span class="category-post">基于 Centos7 的 Zookeeper 安装</span></a> <a href="/posts/13858/" title="软件工程随笔" class="list-group-item list-group-item-action"><span class="category-post">软件工程随笔</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Java 多线程学习笔记</h1><p class="note note-warning">本文最后更新于：2022年12月8日 晚上</p><div class="markdown-body"><h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><ul><li>线程就是独立的执行路径</li><li>在程序运行时，即使没有自己创建线程，后台也会有多个线程，如主线程，gc 线程</li><li>main () 称之为主线程，为系统入口，用于执行整个程序</li><li>在一个进程中，如果开辟了多个线程，线程的运行由调度器安排调度，调度器是与操作系统紧密相关的，先后顺序是不能人为的干预的</li><li>对同一份资源操作时，会存在资源抢夺的问题，需要加入并发控制</li><li>线程会带来额外的开销，如 cpu 调度时间，并发控制开销</li><li>每个线程在自己的工作内存交互，内存控制不当会造成数据不一致</li></ul><h1 id="线程创建"><a href="#线程创建" class="headerlink" title="线程创建"></a>线程创建</h1><blockquote><p>三种创建方式</p></blockquote><p>thread class 继承 thread 类（重点）</p><p>runnable 实现 runnable 接口（重点）</p><p>callable 实现 callable 接口（了解）</p><h2 id="thread类"><a href="#thread类" class="headerlink" title="thread类"></a>thread 类</h2><ul><li>自定义线程类继承 thread 类</li><li>重写 run () 方法，编写线程执行体</li><li>创建线程对象，调用 start () 方法启动线程</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//创建线程方式一：继承thread类，重写run()方法，调用start开启线程</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThread1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {<br>            System.out.println(<span class="hljs-string">"我在看代码---"</span> + i);<br>        }<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {<br>        <span class="hljs-comment">//主线程</span><br><br>        <span class="hljs-comment">//创建一个线程对象</span><br>        <span class="hljs-type">TestThread1</span> <span class="hljs-variable">testThread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread1</span>();<br><br>        <span class="hljs-comment">//调用start()方法开启线程</span><br>        testThread1.start();<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">200</span>; i++) {<br>            System.out.println(<span class="hljs-string">"我在学习多线程---"</span> + i);<br>        }<br>    }<br>}<br><br></code></pre></td></tr></tbody></table></figure><h3 id="多线程-通过继承thread类下载图片"><a href="#多线程-通过继承thread类下载图片" class="headerlink" title="多线程 通过继承thread类下载图片"></a>多线程 通过继承 thread 类下载图片</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-keyword">import</span> org.apache.commons.io.FileUtils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//练习thread，实现多线程同步下载图片</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThread2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	<span class="hljs-keyword">private</span> String url; <span class="hljs-comment">//网络图片地址</span><br>	<span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//保存的文件名</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">TestThread2</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-built_in">this</span>.url = url;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-type">WebDownloader</span> <span class="hljs-variable">webDownloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebDownloader</span>();<br>		webDownloader.downloader(url, name);<br>		System.out.println(<span class="hljs-string">"下载了文件名为"</span> + name);<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3363295869,2467511306&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"1.jpg"</span>);<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1603365312,3218205429&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"2.jpg"</span>);<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss2.bdstatic.com/6Ot1bjeh1BF3odCf/it/u=1736043069,1982275433&amp;fm=85&amp;app=63&amp;f=JPEG?w=121&amp;h=75&amp;s=B1A05B305030FB90A40C9CE50300F0E0"</span>, <span class="hljs-string">"3.jpg"</span>);<br>		<br>		<span class="hljs-comment">//理想情况下下载顺序为1.2.3</span><br>		t1.start();<br>		t2.start();<br>		t3.start();<br>	}<br>}<br><br><span class="hljs-comment">//下载器</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebDownloader</span> {<br>	<span class="hljs-comment">//下载方法</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloader</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-keyword">try</span> {<br>			FileUtils.copyURLToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url), <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(name));<br>		} <span class="hljs-keyword">catch</span> (IOException e) {<br>			e.printStackTrace();<br>			System.out.println(<span class="hljs-string">"IO异常，downloader方法出现问题"</span>);<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>实际下载顺序</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184816.png" srcset="/img/loading.gif" lazyload alt="image-20210306151643332"></p><h2 id="实现runnable-接口"><a href="#实现runnable-接口" class="headerlink" title="实现runnable 接口"></a>实现 runnable 接口</h2><ul><li>定义测试类实现 runnable 接口</li><li>实现 run () 方法，编写线程执行体</li><li>创建线程对象，调用 start () 方法启动线程</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//创建线程方式2：实现runnable接口，重写run()方法，调用start开启线程</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThread3</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-comment">//创建runnable接口的实现类对象</span><br>		<span class="hljs-type">TestThread3</span> <span class="hljs-variable">testThread3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread3</span>();<br>		<br>		<span class="hljs-comment">//创建线程对象，通过线程对象来开启线程代理</span><br><span class="hljs-comment">//		Thread thread = new Thread(testThread3);</span><br><span class="hljs-comment">//		thread.start();</span><br>		<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testThread3).start();<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">200</span>; i++) {<br>			System.out.println(<span class="hljs-string">"我在学习多线程---"</span> + i);<br>		}<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {<br>			System.out.println(<span class="hljs-string">"我在看代码---"</span> + i);<br>		}<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><h3 id="多线程通过实现runnable接口下载图片"><a href="#多线程通过实现runnable接口下载图片" class="headerlink" title="多线程通过实现runnable接口下载图片"></a>多线程通过实现 runnable 接口下载图片</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-keyword">import</span> org.apache.commons.io.FileUtils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//练习thread，实现多线程同步下载图片</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThread2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-keyword">private</span> String url; <span class="hljs-comment">//网络图片地址</span><br>	<span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//保存的文件名</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">TestThread2</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-built_in">this</span>.url = url;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-type">WebDownloader</span> <span class="hljs-variable">webDownloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebDownloader</span>();<br>		webDownloader.downloader(url, name);<br>		System.out.println(<span class="hljs-string">"下载了文件名为"</span> + name);<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3363295869,2467511306&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"1.jpg"</span>);<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1603365312,3218205429&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"2.jpg"</span>);<br>		<span class="hljs-type">TestThread2</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread2</span>(<span class="hljs-string">"https://dss2.bdstatic.com/6Ot1bjeh1BF3odCf/it/u=1736043069,1982275433&amp;fm=85&amp;app=63&amp;f=JPEG?w=121&amp;h=75&amp;s=B1A05B305030FB90A40C9CE50300F0E0"</span>, <span class="hljs-string">"3.jpg"</span>);<br>		<br>		<span class="hljs-comment">//理想情况下下载顺序为1.2.3</span><br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(t1).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(t2).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(t3).start();<br>	}<br>}<br><br><span class="hljs-comment">//下载器</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebDownloader</span> {<br>	<span class="hljs-comment">//下载方法</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloader</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-keyword">try</span> {<br>			FileUtils.copyURLToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url), <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(name));<br>		} <span class="hljs-keyword">catch</span> (IOException e) {<br>			e.printStackTrace();<br>			System.out.println(<span class="hljs-string">"IO异常，downloader方法出现问题"</span>);<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="实现callable接口"><a href="#实现callable接口" class="headerlink" title="实现callable接口"></a>实现 callable 接口</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo02;<br><br><span class="hljs-keyword">import</span> org.apache.commons.io.FileUtils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/7</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Boolean&gt; {<br>	<span class="hljs-keyword">private</span> String url; <span class="hljs-comment">//网络图片地址</span><br>	<span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//保存的文件名</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCallable</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-built_in">this</span>.url = url;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">call</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {<br>		<span class="hljs-type">WebDownloader</span> <span class="hljs-variable">webDownloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebDownloader</span>();<br>		webDownloader.downloader(url, name);<br>		System.out.println(<span class="hljs-string">"下载了文件名为"</span> + name);<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3363295869,2467511306&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"1.jpg"</span>);<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1603365312,3218205429&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"2.jpg"</span>);<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss2.bdstatic.com/6Ot1bjeh1BF3odCf/it/u=1736043069,1982275433&amp;fm=85&amp;app=63&amp;f=JPEG?w=121&amp;h=75&amp;s=B1A05B305030FB90A40C9CE50300F0E0"</span>, <span class="hljs-string">"3.jpg"</span>);<br>		<br>		<span class="hljs-comment">//创建执行服务</span><br>		<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">ser</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">3</span>);<br>		<br>		<span class="hljs-comment">//提交执行</span><br>		Future&lt;Boolean&gt; r1 = ser.submit(t1);<br>		Future&lt;Boolean&gt; r2 = ser.submit(t2);<br>		Future&lt;Boolean&gt; r3 = ser.submit(t3);<br>		<br>		<span class="hljs-comment">//获取结果</span><br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs1</span> <span class="hljs-operator">=</span> r1.get();<br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs2</span> <span class="hljs-operator">=</span> r2.get();<br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs3</span> <span class="hljs-operator">=</span> r3.get();<br>		<br>		System.out.println(rs1);<br>		System.out.println(rs2);<br>		System.out.println(rs3);<br>		<br>		<span class="hljs-comment">//关闭服务</span><br>		ser.shutdownNow();<br>	}<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebDownloader</span> {<br>	<span class="hljs-comment">//下载方法</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloader</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-keyword">try</span> {<br>			FileUtils.copyURLToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url), <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(name));<br>		} <span class="hljs-keyword">catch</span> (IOException e) {<br>			e.printStackTrace();<br>			System.out.println(<span class="hljs-string">"IO异常，downloader方法出现问题"</span>);<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184830.png" srcset="/img/loading.gif" lazyload alt="image-20210307145021489"></p><h2 id="线程创建小结"><a href="#线程创建小结" class="headerlink" title="线程创建小结"></a>线程创建小结</h2><ul><li><p>继承 thread 类</p><ul><li>子类继承 thread 类具备多线程能力</li><li>启动线程：子类对象.start ()</li><li>不建议使用：避免 oop 单继承的局限性</li></ul></li><li><p>实现 runnable 接口</p><ul><li>实现接口 runnable 具有多线程能力</li><li>启动线程：new thread (传入目标对象).start ()</li><li>推荐使用：避免单继承的局限性，灵活方便，方便同一个对象被多个线程使用</li></ul></li></ul><h3 id="初始并发问题"><a href="#初始并发问题" class="headerlink" title="初始并发问题"></a>初始并发问题</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//多个线程同时操作同一个对象</span><br><span class="hljs-comment">//买火车票的例子</span><br><span class="hljs-comment">//发现问题：多个线程操作同一个资源的情况下，线程不安全，数据紊乱</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestThread4</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<br>	<span class="hljs-comment">//票数</span><br>	<span class="hljs-type">int</span> <span class="hljs-variable">ticketNums</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>			<span class="hljs-keyword">if</span> (ticketNums &lt;= <span class="hljs-number">0</span>) {<br>				<span class="hljs-keyword">break</span>;<br>			}<br>			<span class="hljs-comment">//模拟延时</span><br>			<span class="hljs-keyword">try</span> {<br>				Thread.sleep(<span class="hljs-number">200</span>);<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>			System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"--&gt;拿到了第"</span> + ticketNums-- + <span class="hljs-string">"张票"</span>);<br>		}<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">TestThread4</span> <span class="hljs-variable">ticket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestThread4</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ticket, <span class="hljs-string">"小明"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ticket, <span class="hljs-string">"老师"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(ticket, <span class="hljs-string">"黄牛党"</span>).start();<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184835.png" srcset="/img/loading.gif" lazyload alt="image-20210306180814536"></p><h3 id="龟兔赛跑"><a href="#龟兔赛跑" class="headerlink" title="龟兔赛跑"></a>龟兔赛跑</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo01;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/6</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//模拟龟兔赛跑</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Race</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String Winner;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100</span>; i++) {<br>            <span class="hljs-comment">//模拟睡觉</span><br>			<span class="hljs-keyword">if</span> (Thread.currentThread().getName().equals(<span class="hljs-string">"兔子"</span>) &amp;&amp; i == <span class="hljs-number">10</span>) {<br>				<span class="hljs-keyword">try</span> {<br>					Thread.sleep(<span class="hljs-number">1</span>);<br>				} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>					e.printStackTrace();<br>				}<br>			}<br>			<span class="hljs-comment">//判断比赛是否结束</span><br>			<span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> gameOver(i);<br>			<span class="hljs-keyword">if</span> (flag) {<br>				<span class="hljs-keyword">break</span>;<br>			}<br>			System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"--&gt;跑了"</span> + i + <span class="hljs-string">"步"</span>);<br>		}<br>	}<br>	<br>	<span class="hljs-comment">//判断是否完成比赛</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">gameOver</span> <span class="hljs-params">(<span class="hljs-type">int</span> steps)</span> {<br>		<span class="hljs-comment">//判断是否有胜利者</span><br>		<span class="hljs-keyword">if</span> (Winner != <span class="hljs-literal">null</span>) {<br>			<span class="hljs-comment">//已经存在胜利者</span><br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>		}<br>		<span class="hljs-keyword">if</span> (steps &gt;= <span class="hljs-number">100</span>) {<br>			Winner = Thread.currentThread().getName();<br>			System.out.println(<span class="hljs-string">"胜利者是:"</span> + Winner);<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>		}<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">Race</span> <span class="hljs-variable">race</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Race</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(race, <span class="hljs-string">"兔子"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(race, <span class="hljs-string">"乌龟"</span>).start();<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><h1 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h1><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> demo03;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/7</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//静态代理总结</span><br><span class="hljs-comment">//真实对象和代理对象都要实现同一个接口</span><br><span class="hljs-comment">//代理对象要代理真实对象</span><br><span class="hljs-comment">//好处：1.代理对象可以做很多真实对象做不了的事情  2.真实对象专注做自己的事</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticProxy</span> {<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      <span class="hljs-type">WeddingCompany</span> <span class="hljs-variable">weddingCompany</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeddingCompany</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">You</span>());<br>      weddingCompany.Marry();<br>   }<br>}<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Marry</span> {<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">Marry</span> <span class="hljs-params">()</span>;<br>}<br><br><span class="hljs-comment">//真实</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">You</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Marry</span> {<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Marry</span> <span class="hljs-params">()</span> {<br>      System.out.println(<span class="hljs-string">"要结婚！"</span>);<br>   }<br>}<br><br><span class="hljs-comment">//代理</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WeddingCompany</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Marry</span> {<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">Marry</span> <span class="hljs-params">()</span> {<br>      before();<br>      <span class="hljs-built_in">this</span>.target.Marry();<br>      after();<br>   }<br>   <br>   <span class="hljs-keyword">private</span> Marry target;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">WeddingCompany</span> <span class="hljs-params">(Marry target)</span> {<br>      <span class="hljs-built_in">this</span>.target = target;<br>   }<br>   <br>   <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">after</span> <span class="hljs-params">()</span> {<br>      System.out.println(<span class="hljs-string">"结婚后"</span>);<br>   }<br>   <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span> <span class="hljs-params">()</span> {<br>      System.out.println(<span class="hljs-string">"结婚前"</span>);<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><h1 id="Lambda-表达式"><a href="#Lambda-表达式" class="headerlink" title="Lambda 表达式"></a>Lambda 表达式</h1><h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><ul><li>函数式接口的定义：<ul><li>任何接口，如果只包含唯一一个抽象方法，那么它就是一个函数式接口</li><li>对于函数式接口，我们可以通过 lambda 表达式来创建给接口的对象</li></ul></li><li>为什么需要使用 lambda 表达式：<ul><li>避免内部类定义过多</li><li>代码整洁</li><li>去掉无意义的代码，只留下核心逻辑</li></ul></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo04;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/7</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//推导lambda表达式</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLambda1</span> {<br>	<span class="hljs-comment">//3.静态内部类</span><br>	<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Like2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILike</span> {<br>		<span class="hljs-meta">@Override</span><br>		<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lambda</span> <span class="hljs-params">()</span> {<br>			System.out.println(<span class="hljs-string">"I Like Lambda2"</span>);<br>		}<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">ILike</span> <span class="hljs-variable">Like</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Like</span>();<br>		Like.lambda();<br>		<br>		Like = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Like2</span>();<br>		Like.lambda();<br>		<br>		<span class="hljs-comment">//4.局部内部类</span><br>		<span class="hljs-keyword">class</span> <span class="hljs-title class_">Like3</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILike</span> {<br>			<span class="hljs-meta">@Override</span><br>			<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lambda</span> <span class="hljs-params">()</span> {<br>				System.out.println(<span class="hljs-string">"I Like Lambda3"</span>);<br>			}<br>		}<br>		Like = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Like3</span>();<br>		Like.lambda();<br>		<br>		<span class="hljs-comment">//5.匿名内部类</span><br>		Like = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ILike</span>() {<br>			<span class="hljs-meta">@Override</span><br>			<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lambda</span> <span class="hljs-params">()</span> {<br>				System.out.println(<span class="hljs-string">"I Like Lambda4"</span>);<br>			}<br>		};<br>		Like.lambda();<br>		<br>		<span class="hljs-comment">//6.用lambda表达式</span><br>		Like = () -&gt; System.out.println(<span class="hljs-string">"I Like Lambda5"</span>);<br>		Like.lambda();<br>	}<br>}<br><br><span class="hljs-comment">//1.定义一个函数式接口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILike</span> {<br>	<span class="hljs-keyword">void</span> <span class="hljs-title function_">lambda</span> <span class="hljs-params">()</span>;<br>}<br><br><span class="hljs-comment">//2.实现类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Like</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ILike</span> {<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lambda</span> <span class="hljs-params">()</span> {<br>		System.out.println(<span class="hljs-string">"I Like Lambda"</span>);<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="lambda表达式（带参数）"><a href="#lambda表达式（带参数）" class="headerlink" title="lambda表达式（带参数）"></a>lambda 表达式（带参数）</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> demo04;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/7</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLambda2</span> {<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      ((ILove) a -&gt; System.out.println(a)).love(<span class="hljs-number">1</span>);<br>   }<br>}<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ILove</span> {<br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">love</span> <span class="hljs-params">(<span class="hljs-type">int</span> a)</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><h1 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h1><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184936.png" srcset="/img/loading.gif" lazyload alt="image-20210308201539431"></p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184939.png" srcset="/img/loading.gif" lazyload alt="image-20210308201728340"></p><h2 id="线程停止"><a href="#线程停止" class="headerlink" title="线程停止"></a>线程停止</h2><ul><li>建议线程正常停止–&gt; 利用次数，不是死循环</li><li>建议使用标志位–&gt; 设置一个标志位</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//测试stop</span><br><span class="hljs-comment">//1.建议线程正常停止--&gt;利用次数，不是死循环</span><br><span class="hljs-comment">//2.建议使用标志位--&gt;设置一个标志位</span><br><span class="hljs-comment">//3.不要使用stop和destroy等过时或JDK不推荐的的方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestStop</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>   <br>   <span class="hljs-comment">//设置一个标志位</span><br>   <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      <span class="hljs-type">TestStop</span> <span class="hljs-variable">testStop</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestStop</span>();<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testStop).start();<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {<br>         System.out.println(i);<br>         <span class="hljs-keyword">if</span> (i == <span class="hljs-number">900</span>) {<br>            <span class="hljs-comment">//调用stop</span><br>            testStop.stop();<br>            System.out.println(<span class="hljs-string">"线程停止"</span>);<br>         }<br>      }<br>   }<br>   <br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>      <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>      <span class="hljs-keyword">while</span> (flag) {<br>         System.out.println(<span class="hljs-string">"run......thread"</span> + i++);<br>      }<br>   }<br>   <br>   <span class="hljs-comment">//设置一个公开的方法停止线程，转换标志</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span> <span class="hljs-params">()</span> {<br>      <span class="hljs-built_in">this</span>.flag = <span class="hljs-literal">false</span>;<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="线程休眠"><a href="#线程休眠" class="headerlink" title="线程休眠"></a>线程休眠</h2><ul><li>sleep (时间) 指定当前线程阻塞的毫秒数</li><li>sleep 存在异常 InterruptedException</li><li>sleep 时间达到后线程进入就绪状态</li><li>sleep 可以模仿网络延迟，倒计时等</li><li>每一个对象都有一个锁，sleep 不会释放锁</li></ul><blockquote><p>模拟倒计时</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//模拟倒计时</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSleep2</span> {<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      <span class="hljs-keyword">try</span> {<br>         tenDown();<br>      } <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>         e.printStackTrace();<br>      }<br>   }<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tenDown</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>      <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>         Thread.sleep(<span class="hljs-number">1000</span>);<br>         System.out.println(num--);<br>         <span class="hljs-keyword">if</span> (num &lt;= <span class="hljs-number">0</span>) {<br>            <span class="hljs-keyword">break</span>;<br>         }<br>      }<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><blockquote><p>打印当前时间</p></blockquote><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-keyword">import</span> java.text.SimpleDateFormat;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSleep2</span> {<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      <span class="hljs-comment">//打印当前系统时间</span><br>      <span class="hljs-type">Date</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis());<br>      <br>      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>         <span class="hljs-keyword">try</span> {<br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>            System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">"HH:mm:ss"</span>).format(startTime));<br>            <span class="hljs-comment">//更新时间</span><br>            startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis());<br>         } <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>            e.printStackTrace();<br>         }<br>      }<br>   }<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tenDown</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>      <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>      <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>         Thread.sleep(<span class="hljs-number">1000</span>);<br>         System.out.println(num--);<br>         <span class="hljs-keyword">if</span> (num &lt;= <span class="hljs-number">0</span>) {<br>            <span class="hljs-keyword">break</span>;<br>         }<br>      }<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><h2 id="线程礼让"><a href="#线程礼让" class="headerlink" title="线程礼让"></a>线程礼让</h2><ul><li>礼让线程，让当前正在执行的线程暂停，但不阻塞</li><li>将线程从运行状态转为就绪状态</li><li>让 cpu 重新调度，礼让不一定成功</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//测试礼让线程</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestYield</span> {<br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>      <span class="hljs-type">MyYield</span> <span class="hljs-variable">myYield</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyYield</span>();<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(myYield, <span class="hljs-string">"a"</span>).start();<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(myYield, <span class="hljs-string">"b"</span>).start();<br>   }<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyYield</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>      System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"开始"</span>);<br>      Thread.yield();<br>      System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"停止"</span>);<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><p>礼让成功：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184945.png" srcset="/img/loading.gif" lazyload alt="image-20210308211529467"></p><p>礼让失败：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184946.png" srcset="/img/loading.gif" lazyload alt="image-20210308211517419"></p><h2 id="线程join"><a href="#线程join" class="headerlink" title="线程join"></a>线程 join</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//测试join方法    插队</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestJoin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">300</span>; i++) {<br>         System.out.println(<span class="hljs-string">"vip"</span> + i);<br>      }<br>   }<br>   <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>      <span class="hljs-type">TestJoin</span> <span class="hljs-variable">testJoin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestJoin</span>();<br>      <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testJoin);<br>      <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {<br>         <span class="hljs-keyword">if</span> (i == <span class="hljs-number">200</span>) {<br>            thread.start();<br>            thread.join();<br>         }<br>         System.out.println(<span class="hljs-string">"main"</span> + i);<br>      }<br>   }<br>}<br></code></pre></td></tr></tbody></table></figure><h1 id="观测线程状态"><a href="#观测线程状态" class="headerlink" title="观测线程状态"></a>观测线程状态</h1><ul><li>线程结束不能再启动</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/8</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestState</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>		<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {<br>			<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {<br>				<span class="hljs-keyword">try</span> {<br>					Thread.sleep(<span class="hljs-number">1000</span>);<br>				} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>					e.printStackTrace();<br>				}<br>			}<br>			System.out.println(<span class="hljs-string">"666"</span>);<br>		});<br>		<br>		<span class="hljs-comment">//观察状态</span><br>		Thread.<span class="hljs-type">State</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> thread.getState();<br>		System.out.println(state);<br>		<br>		<span class="hljs-comment">//观察启动后</span><br>		thread.start();<br>		state = thread.getState();<br>		System.out.println(state);<br>		<br>		<span class="hljs-keyword">while</span> (state != Thread.State.TERMINATED) {<br>			<span class="hljs-comment">//只要线程不终止，一直输出状态</span><br>			Thread.sleep(<span class="hljs-number">100</span>);<br>			state = thread.getState();<span class="hljs-comment">//更新线程状态</span><br>			System.out.println(state);<span class="hljs-comment">//输出状态</span><br>		}<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><h1 id="线程优先级"><a href="#线程优先级" class="headerlink" title="线程优先级"></a>线程优先级</h1><ul><li>Java 提供 — 个线程调度器来监控程序中启动后进入就绪状态的所有线程，线程调度器按照优先级决定应该调度哪个线程来执行。</li><li>线程的优先级用数字表示，范围从 1-10.<ul><li>Thread. MIN_PRIORITY= 1</li><li>Thread.MAX_PRIORITY= 10</li><li>Thread.NORM_PRIORITy=5</li></ul></li><li>使用以下方式改变或获取优先级<ul><li>getPriority() setPriority(int xxx)</li></ul></li></ul><h1 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h1><ul><li>线程分为用户线程和守护线程</li><li>虚拟机必须确保用户线程执行完毕</li><li>虚拟机不用等待守护线程执行完毕，如：后台记录操作日志，监控内存，垃圾回收等待。。。</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">package</span> state;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/9</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//测试守护线程</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDaemon</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">God</span> <span class="hljs-variable">god</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">God</span>();<br>		<span class="hljs-type">You</span> <span class="hljs-variable">you</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">You</span>();<br>		<br>		<span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(god);<br>		thread.setDaemon(<span class="hljs-literal">true</span>); <span class="hljs-comment">//守护线程，默认false表示用户线程</span><br>		thread.start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(you).start();<span class="hljs-comment">//用户线程</span><br>	}<br>}<br><br><span class="hljs-comment">//守护线程类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">God</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>			System.out.println(<span class="hljs-string">"守护"</span>);<br>		}<br>	}<br>}<br><br><span class="hljs-comment">//用户线程类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">You</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">36500</span>; i++) {<br>			System.out.println(<span class="hljs-string">"开心"</span>);<br>		}<br>		System.out.println(<span class="hljs-string">"Goodbye,world!"</span>);<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><h1 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h1><ul><li>形成条件：队列 + 锁</li><li>锁机制：synchronized</li></ul><h2 id="不安全的案例"><a href="#不安全的案例" class="headerlink" title="不安全的案例"></a>不安全的案例</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/9</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//不安全的买票</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeBuyTicket</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">BuyTicket</span> <span class="hljs-variable">station</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuyTicket</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"苦逼的我"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"牛逼的你"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"黄牛党"</span>).start();<br>	}<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuyTicket</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-comment">//票</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ticketNums</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>	<span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-comment">//买票</span><br>		<span class="hljs-keyword">while</span> (flag) {<br>			<span class="hljs-keyword">try</span> {<br>				buy();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>	}<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buy</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>		<span class="hljs-comment">//判断是否有票</span><br>		<span class="hljs-keyword">if</span> (ticketNums &lt;= <span class="hljs-number">0</span>) {<br>			flag = <span class="hljs-literal">false</span>;<br>			<span class="hljs-keyword">return</span>;<br>		}<br>		<span class="hljs-comment">//模拟延迟</span><br>		Thread.sleep(<span class="hljs-number">100</span>);<br>		<span class="hljs-comment">//买票</span><br>		System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"拿到"</span> + ticketNums--);<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>输出结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184952.png" srcset="/img/loading.gif" lazyload alt="image-20210320214859681"></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/20</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//不安全的取钱</span><br><span class="hljs-comment">//两个人取银行取钱，账户</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeBank</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-comment">//账户</span><br>		<span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"结婚基金"</span>);<br>		<span class="hljs-type">Drawing</span> <span class="hljs-variable">you</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Drawing</span>(account, <span class="hljs-number">50</span>, <span class="hljs-string">"你"</span>);<br>		<span class="hljs-type">Drawing</span> <span class="hljs-variable">girl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Drawing</span>(account, <span class="hljs-number">100</span>, <span class="hljs-string">"女孩"</span>);<br>		you.start();<br>		girl.start();<br>	}<br>}<br><br><span class="hljs-comment">//账户</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {<br>	<span class="hljs-type">int</span> money;<br>	String name;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Account</span> <span class="hljs-params">(<span class="hljs-type">int</span> money, String name)</span> {<br>		<span class="hljs-built_in">this</span>.money = money;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>}<br><br><span class="hljs-comment">//银行：模拟取款</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Drawing</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	<span class="hljs-comment">//账户</span><br>	Account account;<br>	<span class="hljs-comment">//取了多少钱</span><br>	<span class="hljs-type">int</span> drawingMoney;<br>	<span class="hljs-comment">//现在手里有多少钱</span><br>	<span class="hljs-type">int</span> nowMoney;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Drawing</span> <span class="hljs-params">(Account account, <span class="hljs-type">int</span> drawingMoney, String name)</span> {<br>		<span class="hljs-built_in">super</span>(name);<br>		<span class="hljs-built_in">this</span>.account = account;<br>		<span class="hljs-built_in">this</span>.drawingMoney = drawingMoney;<br>	}<br>	<br>	<span class="hljs-comment">//取钱</span><br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">if</span> (account.money - drawingMoney &lt; <span class="hljs-number">0</span>) {<br>			System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"钱不够，取不了"</span>);<br>			<span class="hljs-keyword">return</span>;<br>		}<br>		<span class="hljs-keyword">try</span> {<br>			Thread.sleep(<span class="hljs-number">1000</span>);<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>		<span class="hljs-comment">//卡内余额</span><br>		account.money = account.money - drawingMoney;<br>		<span class="hljs-comment">//你手里的钱</span><br>		nowMoney = nowMoney + drawingMoney;<br>		<br>		System.out.println(account.name + <span class="hljs-string">"余额为："</span> + account.money);<br>		System.out.println(<span class="hljs-built_in">this</span>.getName() + <span class="hljs-string">"手里的钱："</span> + nowMoney);<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>输出结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184956.png" srcset="/img/loading.gif" lazyload alt="image-20210320214937951"></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/20</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//线程不安全的集合</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeList</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {<br>			<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {<br>				list.add(Thread.currentThread().getName());<br>			}).start();<br>		}<br>		<span class="hljs-keyword">try</span> {<br>			Thread.sleep(<span class="hljs-number">3000</span>);<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>		System.out.println(list.size());<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>输出结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430184958.png" srcset="/img/loading.gif" lazyload alt="image-20210320215017646"></p><h2 id="同步方法"><a href="#同步方法" class="headerlink" title="同步方法"></a>同步方法</h2><ul><li><p>synchronized 关键字，包括两种用法：synchronized 方法 和 synchronized 块</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">(<span class="hljs-type">int</span> args)</span>{} <span class="hljs-comment">//同步方法</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>synchronized 方法控制对” 对象 “的访问，每个对象对应着一把锁 ，每个 synchronized 方法都必须获得调用该方法的对象的锁才能执行，否则线程阻塞，方法一旦执行，就会独占该锁，知道方法返回菜释放锁，后面被阻塞的线程才能获得这个锁，继续执行</p><p>缺陷：若将一个大的方法声明为 synchronized 将会影响效率</p></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/9</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//不安全的买票</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeBuyTicket</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">BuyTicket</span> <span class="hljs-variable">station</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuyTicket</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"苦逼的我"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"牛逼的你"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(station, <span class="hljs-string">"黄牛党"</span>).start();<br>	}<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuyTicket</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-comment">//票</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">ticketNums</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>	<span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-comment">//买票</span><br>		<span class="hljs-keyword">while</span> (flag) {<br>			<span class="hljs-keyword">try</span> {<br>				buy();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>	}<br>	<br>	<span class="hljs-comment">//synchronized 同步方法，锁的是this</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">buy</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>		<span class="hljs-comment">//判断是否有票</span><br>		<span class="hljs-keyword">if</span> (ticketNums &lt;= <span class="hljs-number">0</span>) {<br>			flag = <span class="hljs-literal">false</span>;<br>			<span class="hljs-keyword">return</span>;<br>		}<br>		<span class="hljs-comment">//模拟延迟</span><br>		Thread.sleep(<span class="hljs-number">500</span>);<br>		<span class="hljs-comment">//买票</span><br>		System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"拿到"</span> + ticketNums--);<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185001.png" srcset="/img/loading.gif" lazyload alt="image-20210321122211482"></p><h2 id="同步块"><a href="#同步块" class="headerlink" title="同步块"></a>同步块</h2><ul><li>同步块：synchronized（obj）{}</li><li>obj 称之为 ** 同步监视器 **(一定是要增删改查的对象)<ul><li>obj 可以是任何对象，但是推荐使用共享资源作为同步监视器</li><li>同步方法中无需指定同步监视器，因为同步方法的同步监视器就是 this，就是这个对象本身，或者是 class</li></ul></li><li>同步监视器的执行过程<ol><li>第一个线程访问，锁定同步监视器，执行其中的代码</li><li>第二个线程访问，发现同步监视器被锁定，无法访问</li><li>第一个线程访问完毕，解锁同步监视器</li><li>第二个线程访问，发现同步监视器没有锁，然后锁定并访问</li></ol></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/20</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-comment">//不安全的取钱</span><br><span class="hljs-comment">//两个人取银行取钱，账户</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeBank</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-comment">//账户</span><br>		<span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-number">100</span>, <span class="hljs-string">"结婚基金"</span>);<br>		<span class="hljs-type">Drawing</span> <span class="hljs-variable">you</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Drawing</span>(account, <span class="hljs-number">50</span>, <span class="hljs-string">"你"</span>);<br>		<span class="hljs-type">Drawing</span> <span class="hljs-variable">girl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Drawing</span>(account, <span class="hljs-number">100</span>, <span class="hljs-string">"女孩"</span>);<br>		you.start();<br>		girl.start();<br>	}<br>}<br><br><span class="hljs-comment">//账户</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {<br>	<span class="hljs-type">int</span> money;<br>	String name;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Account</span> <span class="hljs-params">(<span class="hljs-type">int</span> money, String name)</span> {<br>		<span class="hljs-built_in">this</span>.money = money;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>}<br><br><span class="hljs-comment">//银行：模拟取款</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Drawing</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	<span class="hljs-comment">//账户</span><br>	Account account;<br>	<span class="hljs-comment">//取了多少钱</span><br>	<span class="hljs-type">int</span> drawingMoney;<br>	<span class="hljs-comment">//现在手里有多少钱</span><br>	<span class="hljs-type">int</span> nowMoney;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Drawing</span> <span class="hljs-params">(Account account, <span class="hljs-type">int</span> drawingMoney, String name)</span> {<br>		<span class="hljs-built_in">super</span>(name);<br>		<span class="hljs-built_in">this</span>.account = account;<br>		<span class="hljs-built_in">this</span>.drawingMoney = drawingMoney;<br>	}<br>	<br>	<span class="hljs-comment">//取钱</span><br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">synchronized</span> (account) {<br>			<span class="hljs-keyword">if</span> (account.money - drawingMoney &lt; <span class="hljs-number">0</span>) {<br>				System.out.println(Thread.currentThread().getName() + <span class="hljs-string">"钱不够，取不了"</span>);<br>				<span class="hljs-keyword">return</span>;<br>			}<br>			<span class="hljs-keyword">try</span> {<br>				Thread.sleep(<span class="hljs-number">1000</span>);<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>			<span class="hljs-comment">//卡内余额</span><br>			account.money = account.money - drawingMoney;<br>			<span class="hljs-comment">//你手里的钱</span><br>			nowMoney = nowMoney + drawingMoney;<br>			<br>			System.out.println(account.name + <span class="hljs-string">"余额为："</span> + account.money);<br>			System.out.println(<span class="hljs-built_in">this</span>.getName() + <span class="hljs-string">"手里的钱："</span> + nowMoney);<br>		}<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185004.png" srcset="/img/loading.gif" lazyload alt="image-20210321122248004"></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/20</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//线程不安全的集合</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeList</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;String&gt;();<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {<br>			<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {<br>				<span class="hljs-keyword">synchronized</span> (list) {<br>					list.add(Thread.currentThread().getName());<br>				}<br>			}).start();<br>		}<br>		<span class="hljs-keyword">try</span> {<br>			Thread.sleep(<span class="hljs-number">300</span>);<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>		System.out.println(list.size());<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185007.png" srcset="/img/loading.gif" lazyload alt="image-20210321122359004"></p><h2 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h2><ul><li>JUC 是安全类型集合</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> syn;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//测试JUC安全类型的集合</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestJUC</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		CopyOnWriteArrayList&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CopyOnWriteArrayList</span>&lt;String&gt;();<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {<br>			<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {<br>				list.add(Thread.currentThread().getName());<br>			}).start();<br>		}<br>		<span class="hljs-keyword">try</span> {<br>			Thread.sleep(<span class="hljs-number">3000</span>);<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>		System.out.println(list.size());<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185010.png" srcset="/img/loading.gif" lazyload alt="image-20210321123000746"></p><h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><ul><li><p>产生死锁的四个必要条件：</p><ol><li>互斥条件：一个资源每次只能被一个进程使用。</li><li>请求与保持条件：一个进程因请求资源而阻塞时，对以获得的资源保持不放。</li><li>不剥夺条件：进程已获得的资源，在未使用完之前，不能强行剥夺。</li><li>循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系。</li></ol></li><li><p>死锁，多个线程互相抱着对方需要的资源，形成僵持</p></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Lock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLock</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">Makeup</span> <span class="hljs-variable">g1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Makeup</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"灰姑娘"</span>);<br>		<span class="hljs-type">Makeup</span> <span class="hljs-variable">g2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Makeup</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"白雪公主"</span>);<br>		<br>		g1.start();<br>		g2.start();<br>	}<br>}<br><br><span class="hljs-comment">//口红</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lipstick</span> {<br><br>}<br><br><span class="hljs-comment">//镜子</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mirror</span> {<br><br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Makeup</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	<span class="hljs-comment">//需要资源用static保证只有一份</span><br>	<span class="hljs-keyword">static</span> <span class="hljs-type">Lipstick</span> <span class="hljs-variable">lipstick</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lipstick</span>();<br>	<span class="hljs-keyword">static</span> <span class="hljs-type">Mirror</span> <span class="hljs-variable">mirror</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mirror</span>();<br>	<br>	<span class="hljs-type">int</span> choice;<span class="hljs-comment">//选择</span><br>	String girlName;<span class="hljs-comment">//使用的人</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Makeup</span> <span class="hljs-params">(<span class="hljs-type">int</span> choice, String girlName)</span> {<br>		<span class="hljs-built_in">this</span>.choice = choice;<br>		<span class="hljs-built_in">this</span>.girlName = girlName;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-comment">//化妆</span><br>		<span class="hljs-keyword">try</span> {<br>			makeup();<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>	}<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeup</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>		<span class="hljs-keyword">if</span> (choice == <span class="hljs-number">0</span>) {<br>			<span class="hljs-keyword">synchronized</span> (lipstick) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得口红的锁"</span>);<br>				Thread.sleep(<span class="hljs-number">1000</span>);<br>				<span class="hljs-keyword">synchronized</span> (mirror) {<br>					System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得镜子的锁"</span>);<br>				}<br>			}<br>		} <span class="hljs-keyword">else</span> {<br>			<span class="hljs-keyword">synchronized</span> (mirror) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得镜子的锁"</span>);<br>				Thread.sleep(<span class="hljs-number">1000</span>);<br>				<span class="hljs-keyword">synchronized</span> (lipstick) {<br>					System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得口红的锁"</span>);<br>				}<br>			}<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>程序卡死：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185013.png" srcset="/img/loading.gif" lazyload alt="image-20210321125532165"></p><p>消除死锁后：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Lock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//死锁，多个线程互相抱着对方需要的资源，形成僵持</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeadLock</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">Makeup</span> <span class="hljs-variable">g1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Makeup</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"灰姑娘"</span>);<br>		<span class="hljs-type">Makeup</span> <span class="hljs-variable">g2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Makeup</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"白雪公主"</span>);<br>		<br>		g1.start();<br>		g2.start();<br>	}<br>}<br><br><span class="hljs-comment">//口红</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lipstick</span> {<br><br>}<br><br><span class="hljs-comment">//镜子</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mirror</span> {<br><br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Makeup</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	<span class="hljs-comment">//需要资源用static保证只有一份</span><br>	<span class="hljs-keyword">static</span> <span class="hljs-type">Lipstick</span> <span class="hljs-variable">lipstick</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Lipstick</span>();<br>	<span class="hljs-keyword">static</span> <span class="hljs-type">Mirror</span> <span class="hljs-variable">mirror</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Mirror</span>();<br>	<br>	<span class="hljs-type">int</span> choice;<span class="hljs-comment">//选择</span><br>	String girlName;<span class="hljs-comment">//使用的人</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Makeup</span> <span class="hljs-params">(<span class="hljs-type">int</span> choice, String girlName)</span> {<br>		<span class="hljs-built_in">this</span>.choice = choice;<br>		<span class="hljs-built_in">this</span>.girlName = girlName;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-comment">//化妆</span><br>		<span class="hljs-keyword">try</span> {<br>			makeup();<br>		} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>			e.printStackTrace();<br>		}<br>	}<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">makeup</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {<br>		<span class="hljs-keyword">if</span> (choice == <span class="hljs-number">0</span>) {<br>			<span class="hljs-keyword">synchronized</span> (lipstick) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得口红的锁"</span>);<br>				Thread.sleep(<span class="hljs-number">1000</span>);<br>			}<br>			<span class="hljs-keyword">synchronized</span> (mirror) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得镜子的锁"</span>);<br>			}<br>		} <span class="hljs-keyword">else</span> {<br>			<span class="hljs-keyword">synchronized</span> (mirror) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得镜子的锁"</span>);<br>				Thread.sleep(<span class="hljs-number">1000</span>);<br>			}<br>			<span class="hljs-keyword">synchronized</span> (lipstick) {<br>				System.out.println(<span class="hljs-built_in">this</span>.girlName + <span class="hljs-string">"获得口红的锁"</span>);<br>			}<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185019.png" srcset="/img/loading.gif" lazyload alt="image-20210321125708083"></p><h1 id="lock锁"><a href="#lock锁" class="headerlink" title="lock锁"></a>lock 锁</h1><ul><li>lock 锁是显示锁，需要手动开启关闭</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Lock;<br><br><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLock</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">testlock2</span> <span class="hljs-variable">testlock2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">testlock2</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testlock2, <span class="hljs-string">"一"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testlock2, <span class="hljs-string">"二"</span>).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(testlock2, <span class="hljs-string">"三"</span>).start();<br>	}<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">testlock2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {<br>	<span class="hljs-type">int</span> <span class="hljs-variable">ticketNumber</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br>	<span class="hljs-comment">//定义lock锁</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();<br>	<br>	<span class="hljs-meta">@Override</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {<br>			<span class="hljs-keyword">try</span> {<br>				lock.lock();<span class="hljs-comment">//加锁</span><br>				<span class="hljs-keyword">if</span> (ticketNumber &gt; <span class="hljs-number">0</span>) {<br>					<span class="hljs-keyword">try</span> {<br>						Thread.sleep(<span class="hljs-number">100</span>);<br>					} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>						e.printStackTrace();<br>					}<br>					System.out.println(Thread.currentThread().getName() + ticketNumber--);<br>				} <span class="hljs-keyword">else</span> {<br>					<span class="hljs-keyword">break</span>;<br>				}<br>			} <span class="hljs-keyword">finally</span> {<br>				lock.unlock();<br>			}<br>			<br>		}<br>	}<br>}<br><br></code></pre></td></tr></tbody></table></figure><h1 id="线程协作"><a href="#线程协作" class="headerlink" title="线程协作"></a>线程协作</h1><h2 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h2><ul><li>是一个线程同步的问题，生产者和消费者共享一个资源，并且生产者和消费者之间相互依赖，互为条件</li><li>在生产者消费者问题中，仅有 synchronized 是不够的<ul><li>synchronized 可阻止并发更新同一个共享资源，实现了同步</li><li>synchronized 不能用来实现不同线程之间的信息传递（通信）</li></ul></li><li>Java 提供了几个方法解决这类问题：<ul><li>wait（） 表示线程一直等待，知道其他线程通知，与 sleep（）不同，会释放锁</li><li>wait（long timeout） 指定等待的毫秒数</li><li>notify（） 唤醒一个处于等待状态的线程</li><li>notifyAll（）唤醒同一个对象上所有调用 wait（）方法的线程，优先级别高的线程优先调度</li></ul></li></ul><h2 id="管程法"><a href="#管程法" class="headerlink" title="管程法"></a>管程法</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Lock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">//测试：生产者消费者模型--&gt;利用缓冲区解决：管程法</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPC</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">SynContainer</span> <span class="hljs-variable">container</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynContainer</span>();<br>		<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Producer</span>(container).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>(container).start();<br>	}<br>}<br><br><span class="hljs-comment">//生产者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	SynContainer container;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Producer</span> <span class="hljs-params">(SynContainer container)</span> {<br>		<span class="hljs-built_in">this</span>.container = container;<br>	}<br>	<br>	<span class="hljs-comment">//生产</span><br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {<br>			System.out.println(<span class="hljs-string">"生产了"</span> + i + <span class="hljs-string">"只鸡"</span>);<br>			container.push(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Chicken</span>(i));<br>		}<br>	}<br>}<br><br><span class="hljs-comment">//消费者</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	SynContainer container;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Consumer</span> <span class="hljs-params">(SynContainer container)</span> {<br>		<span class="hljs-built_in">this</span>.container = container;<br>	}<br>	<br>	<span class="hljs-comment">//消费</span><br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {<br>			System.out.println(<span class="hljs-string">"消费了--》"</span> + container.pop().id + <span class="hljs-string">"只鸡"</span>);<br>		}<br>	}<br>}<br><br><span class="hljs-comment">//产品</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Chicken</span> {<br>	<span class="hljs-type">int</span> id;<span class="hljs-comment">//产品编号</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">Chicken</span> <span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {<br>		<span class="hljs-built_in">this</span>.id = id;<br>	}<br>}<br><br><span class="hljs-comment">//缓冲区</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SynContainer</span> {<br>	<span class="hljs-comment">//需要一个容器</span><br>	Chicken[] chickens = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Chicken</span>[<span class="hljs-number">10</span>];<br>	<span class="hljs-comment">//容器计数器</span><br>	<span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>	<br>	<span class="hljs-comment">//生产者放入产品</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">push</span> <span class="hljs-params">(Chicken chicken)</span> {<br>		<span class="hljs-comment">//如果容器满了，就需要等待消费者消费</span><br>		<span class="hljs-keyword">while</span> (count == chickens.length) {<br>			<span class="hljs-comment">//通知消费者消费，生产等待</span><br>			<span class="hljs-keyword">try</span> {<br>				<span class="hljs-built_in">this</span>.wait();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>		<span class="hljs-comment">//如果没有满，就要丢入产品</span><br>		chickens[count] = chicken;<br>		count++;<br>		<span class="hljs-built_in">this</span>.notifyAll();<br>	}<br>	<br>	<span class="hljs-comment">//消费者消费产品</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Chicken <span class="hljs-title function_">pop</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-comment">//判断能否消费</span><br>		<span class="hljs-keyword">while</span> (count == <span class="hljs-number">0</span>) {<br>			<span class="hljs-comment">//等待生产者生产</span><br>			<span class="hljs-keyword">try</span> {<br>				<span class="hljs-built_in">this</span>.wait();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>		<span class="hljs-comment">//如果可以消费</span><br>		count--;<br>		<span class="hljs-type">Chicken</span> <span class="hljs-variable">chicken</span> <span class="hljs-operator">=</span> chickens[count];<br>		<br>		<span class="hljs-built_in">this</span>.notifyAll();<br>		<span class="hljs-comment">//吃完了，通知生产者</span><br>		<span class="hljs-keyword">return</span> chicken;<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185026.png" srcset="/img/loading.gif" lazyload alt="image-20210321182801279"></p><h2 id="标志法"><a href="#标志法" class="headerlink" title="标志法"></a>标志法</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> Lock;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/21</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestPC2</span> {<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> {<br>		<span class="hljs-type">tv</span> <span class="hljs-variable">tv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">tv</span>();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">player</span>(tv).start();<br>		<span class="hljs-keyword">new</span> <span class="hljs-title class_">watcher</span>(tv).start();<br>	}<br>}<br><br><span class="hljs-comment">//生产者--》演员</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">player</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	tv tv;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">player</span> <span class="hljs-params">(tv tv)</span> {<br>		<span class="hljs-built_in">this</span>.tv = tv;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {<br>			<span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {<br>				tv.play(<span class="hljs-string">"快乐大本营"</span>);<br>			} <span class="hljs-keyword">else</span> {<br>				tv.play(<span class="hljs-string">"英雄联盟"</span>);<br>			}<br>		}<br>	}<br>}<br><br><span class="hljs-comment">//消费者--》观众</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">watcher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {<br>	tv tv;<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">watcher</span> <span class="hljs-params">(tv tv)</span> {<br>		<span class="hljs-built_in">this</span>.tv = tv;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {<br>			tv.watch();<br>		}<br>	}<br>}<br><br><span class="hljs-comment">//产品--》电影</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">tv</span> {<br>	<span class="hljs-comment">//演员表演，观众等待 t</span><br>	<span class="hljs-comment">//观众观看，演员等待 f</span><br>	String voice;<span class="hljs-comment">//表演的节目</span><br>	<span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>	<br>	<span class="hljs-comment">//表演</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">play</span> <span class="hljs-params">(String voice)</span> {<br>		<span class="hljs-keyword">if</span> (!flag) {<br>			<span class="hljs-keyword">try</span> {<br>				<span class="hljs-built_in">this</span>.wait();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>		System.out.println(<span class="hljs-string">"演员表演了："</span> + voice);<br>		<span class="hljs-comment">//通知观众观看</span><br>		<span class="hljs-built_in">this</span>.notifyAll();<br>		<span class="hljs-built_in">this</span>.voice = voice;<br>		<span class="hljs-built_in">this</span>.flag = !<span class="hljs-built_in">this</span>.flag;<br>	}<br>	<br>	<span class="hljs-comment">//观看</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watch</span> <span class="hljs-params">()</span> {<br>		<span class="hljs-keyword">if</span> (flag) {<br>			<span class="hljs-keyword">try</span> {<br>				<span class="hljs-built_in">this</span>.wait();<br>			} <span class="hljs-keyword">catch</span> (InterruptedException e) {<br>				e.printStackTrace();<br>			}<br>		}<br>		System.out.println(<span class="hljs-string">"观众观看了："</span> + voice);<br>		<span class="hljs-comment">//通知演员表演</span><br>		<span class="hljs-built_in">this</span>.notifyAll();<br>		<span class="hljs-built_in">this</span>.flag = !<span class="hljs-built_in">this</span>.flag;<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185028.png" srcset="/img/loading.gif" lazyload alt="image-20210321182722741"></p><h1 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h1><h2 id="使用线程池"><a href="#使用线程池" class="headerlink" title="使用线程池"></a>使用线程池</h2><ul><li>经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。</li><li>思路：提前创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具。</li><li>好处：<ul><li>提高响应速度（减少了创建新线程的时间）</li><li>降低资源消耗（重复利用线程池中的线程，不需要每次都创建）</li><li>便于线程管理<ul><li>corePoolSize：核心池的大小</li><li>maximumPoolSize：最大线程数</li><li>keepAliveTime：线程没有任务时最多保持多长时间后会终止</li></ul></li></ul></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> demo02;<br><br><span class="hljs-keyword">import</span> org.apache.commons.io.FileUtils;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><span class="hljs-keyword">import</span> java.util.concurrent.*;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> AWEI</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 2021/3/7</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Boolean&gt; {<br>	<span class="hljs-keyword">private</span> String url; <span class="hljs-comment">//网络图片地址</span><br>	<span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//保存的文件名</span><br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-title function_">TestCallable</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-built_in">this</span>.url = url;<br>		<span class="hljs-built_in">this</span>.name = name;<br>	}<br>	<br>	<span class="hljs-meta">@Override</span><br>	<span class="hljs-keyword">public</span> Boolean <span class="hljs-title function_">call</span> <span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {<br>		<span class="hljs-type">WebDownloader</span> <span class="hljs-variable">webDownloader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebDownloader</span>();<br>		webDownloader.downloader(url, name);<br>		System.out.println(<span class="hljs-string">"下载了文件名为"</span> + name);<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>	}<br>	<br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException {<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3363295869,2467511306&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"1.jpg"</span>);<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1603365312,3218205429&amp;fm=26&amp;gp=0.jpg"</span>, <span class="hljs-string">"2.jpg"</span>);<br>		<span class="hljs-type">TestCallable</span> <span class="hljs-variable">t3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestCallable</span>(<span class="hljs-string">"https://dss2.bdstatic.com/6Ot1bjeh1BF3odCf/it/u=1736043069,1982275433&amp;fm=85&amp;app=63&amp;f=JPEG?w=121&amp;h=75&amp;s=B1A05B305030FB90A40C9CE50300F0E0"</span>, <span class="hljs-string">"3.jpg"</span>);<br>		<br>		<span class="hljs-comment">//创建执行服务</span><br>		<span class="hljs-type">ExecutorService</span> <span class="hljs-variable">ser</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">3</span>);<br>		<br>		<span class="hljs-comment">//提交执行</span><br>		Future&lt;Boolean&gt; r1 = ser.submit(t1);<br>		Future&lt;Boolean&gt; r2 = ser.submit(t2);<br>		Future&lt;Boolean&gt; r3 = ser.submit(t3);<br>		<br>		<span class="hljs-comment">//获取结果</span><br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs1</span> <span class="hljs-operator">=</span> r1.get();<br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs2</span> <span class="hljs-operator">=</span> r2.get();<br>		<span class="hljs-type">boolean</span> <span class="hljs-variable">rs3</span> <span class="hljs-operator">=</span> r3.get();<br>		<br>		System.out.println(rs1);<br>		System.out.println(rs2);<br>		System.out.println(rs3);<br>		<br>		<span class="hljs-comment">//关闭服务</span><br>		ser.shutdownNow();<br>	}<br>}<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WebDownloader</span> {<br>	<span class="hljs-comment">//下载方法</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloader</span> <span class="hljs-params">(String url, String name)</span> {<br>		<span class="hljs-keyword">try</span> {<br>			FileUtils.copyURLToFile(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(url), <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(name));<br>		} <span class="hljs-keyword">catch</span> (IOException e) {<br>			e.printStackTrace();<br>			System.out.println(<span class="hljs-string">"IO异常，downloader方法出现问题"</span>);<br>		}<br>	}<br>}<br></code></pre></td></tr></tbody></table></figure><p>结果：</p><p><img src="https://inencoding.oss-cn-shenzhen.aliyuncs.com/img/20220430185032.png" srcset="/img/loading.gif" lazyload alt="image-20210321213428366"></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-chain-item">学习笔记</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">#多线程</a></div></div><div class="license-box my-3"><div class="license-title"><div>Java 多线程学习笔记</div><div>https://www.inencoding.com/posts/43258/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>AWEI</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2021年3月13日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2022年12月8日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i></span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/posts/15254/" title="Java 网络编程学习笔记"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Java 网络编程学习笔记</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/posts/39805/" title="MySQL 学习笔记"><span class="hidden-mobile">MySQL 学习笔记</span> <span class="visible-mobile">下一篇</span><i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a><i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script></div></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量<span id="busuanzi_value_site_pv"></span> 次</span> <span id="busuanzi_container_site_uv" style="display:none">总访客数<span id="busuanzi_value_site_uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">粤ICP备2021025468号</a></span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing;(t=t.getElementById("subtitle"))&&e&&e(t.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-t}),0<o.find(".toc-list-item").length&&o.css("visibility","visible"))}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o,n=[];for(o of(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","))n.push(".markdown-body > "+o.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="https://fastly.jsdelivr.net/npm/hexo-tag-common@0.1.0/js/index.js"></script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script></body></html>